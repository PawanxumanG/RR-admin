<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RR College Admin - Live Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e6edf3;
            margin: 0;
            overflow-x: hidden;
        }
        .glass-panel {
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(48, 54, 61, 0.6);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 10px;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        .loader {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid #f97316;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        input:focus, textarea:focus {
            box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.2);
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        const safeB64Encode = (str) => btoa(unescape(encodeURIComponent(str)));
        const safeB64Decode = (str) => decodeURIComponent(escape(atob(str)));

        const MASTER_PIN = "Pawan1645@";
        const SESSION_DURATION = 60 * 60 * 1000; // 1 Hour session

        const getDeviceId = () => {
            let id = localStorage.getItem('rr_device_unique_id_v3');
            if (!id) {
                id = 'DEV-' + Math.random().toString(36).substring(2, 7).toUpperCase() + '-' + Date.now().toString().slice(-4);
                localStorage.setItem('rr_device_unique_id_v3', id);
            }
            return id;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('notice'); 
            const [isLoggedIn, setIsLoggedIn] = useState(() => localStorage.getItem('rr_admin_session_v2') === 'active');
            const [currentUser, setCurrentUser] = useState(() => localStorage.getItem('rr_admin_user') || 'ADMIN');
            const [isSecurityUnlocked, setIsSecurityUnlocked] = useState(false);
            const [loginKeyInput, setLoginKeyInput] = useState('');
            const [securityPinInput, setSecurityPinInput] = useState('');
            const [timeLeft, setTimeLeft] = useState(null);
            
            const [config, setConfig] = useState(() => {
                const saved = localStorage.getItem('rr_admin_config_v4');
                return saved ? JSON.parse(saved) : { token: '', owner: 'PawanxumanG', repo: 'rr-college' };
            });

            const [noticeData, setNoticeData] = useState({ show: true, title: '', message: [], updates: { version: '', items: [] } });
            const [announcementData, setAnnouncementData] = useState({ show: false, title: '', message: '' });
            const [eventsData, setEventsData] = useState({ show: true, events: [] });
            const [loginData, setLoginData] = useState({ keys: [] });

            const [shas, setShas] = useState({ notice: null, announcement: null, events: null, security: null });
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState(null);

            useEffect(() => {
                localStorage.setItem('rr_admin_config_v4', JSON.stringify(config));
            }, [config]);

            useEffect(() => {
                let timer;
                if (isLoggedIn) {
                    const sessionStart = parseInt(localStorage.getItem('rr_admin_session_start') || Date.now().toString());
                    if (!localStorage.getItem('rr_admin_session_start')) {
                        localStorage.setItem('rr_admin_session_start', sessionStart.toString());
                    }

                    const updateTimer = () => {
                        const now = Date.now();
                        const elapsed = now - sessionStart;
                        const remaining = Math.max(0, SESSION_DURATION - elapsed);
                        setTimeLeft(remaining);
                        if (remaining <= 0) {
                            handleLogout();
                            notify('error', 'Session Expired. Please login again.');
                        }
                    };
                    updateTimer();
                    timer = setInterval(updateTimer, 1000);
                }
                return () => clearInterval(timer);
            }, [isLoggedIn]);

            const formatTime = (ms) => {
                if (ms === null) return "00:00";
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            };

            const notify = (type, message) => {
                setStatus({ type, message });
                setTimeout(() => setStatus(null), 6000);
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                const currentDeviceId = getDeviceId();
                const masterKey = 'RR-2025';

                const performSuccessfulLogin = (ownerName) => {
                    setIsLoggedIn(true);
                    setCurrentUser(ownerName);
                    localStorage.setItem('rr_admin_session_v2', 'active');
                    localStorage.setItem('rr_admin_user', ownerName);
                    localStorage.setItem('rr_admin_session_start', Date.now().toString());
                    notify('success', `Access Granted: ${ownerName}`);
                };

                if (!loginKeyInput) return notify('error', 'Please enter an Access Key.');
                setLoading(true);

                try {
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/login.json`;
                    const res = await fetch(url, {
                        headers: config.token ? { 'Authorization': `token ${config.token}`, 'Accept': 'application/vnd.github.v3+json' } : { 'Accept': 'application/vnd.github.v3+json' }
                    });
                    
                    if (!res.ok) {
                        // Bypassing for initial setup on new devices
                        if (loginKeyInput === masterKey) {
                            performSuccessfulLogin('MASTER ADMIN (SETUP)');
                            return;
                        }
                        throw new Error('Config missing on this browser. Use Master Key to configure.');
                    }
                    
                    const data = await res.json();
                    const content = JSON.parse(safeB64Decode(data.content));
                    const keyIndex = content.keys.findIndex(k => k.key === loginKeyInput && k.isActive);
                    
                    if (keyIndex !== -1) {
                        const userKey = content.keys[keyIndex];

                        if (userKey.deviceId && userKey.deviceId !== currentDeviceId) {
                            throw new Error(`STRICT POLICY: This key is bound to another device (${userKey.deviceId}). Login Denied.`);
                        }

                        // One Key, One Device: Automatic Binding
                        if (!userKey.deviceId) {
                            content.keys[keyIndex].deviceId = currentDeviceId;
                            const putBody = {
                                message: `Device Bound: ${userKey.owner} locked to ${currentDeviceId}`,
                                content: safeB64Encode(JSON.stringify(content, null, 2)),
                                sha: data.sha
                            };
                            const putRes = await fetch(url, {
                                method: 'PUT',
                                headers: { 'Authorization': `token ${config.token}`, 'Content-Type': 'application/json' },
                                body: JSON.stringify(putBody)
                            });
                            if (!putRes.ok) throw new Error('Device binding failed. Check your GitHub Token.');
                            notify('success', 'System bound to this device.');
                        }

                        performSuccessfulLogin(userKey.owner);
                    } else {
                        notify('error', 'Invalid or Inactive Access Key.');
                    }
                } catch (err) {
                    notify('error', err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setIsSecurityUnlocked(false);
                localStorage.removeItem('rr_admin_session_v2');
                localStorage.removeItem('rr_admin_user');
                localStorage.removeItem('rr_admin_session_start');
            };

            const handleSync = async (targetTab = activeTab) => {
                if (!config.token || !config.owner || !config.repo) {
                    notify('error', 'GitHub configuration missing.');
                    return;
                }
                setLoading(true);
                const mapping = { notice: 'notice.json', announcement: 'announcement.json', events: 'events.json', security: 'login.json' };
                const path = mapping[targetTab];
                try {
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${path}`;
                    const res = await fetch(url, {
                        headers: { 'Authorization': `token ${config.token}`, 'Accept': 'application/vnd.github.v3+json' }
                    });
                    if (!res.ok) throw new Error(`Fetch failed for ${path}`);
                    const data = await res.json();
                    const content = JSON.parse(safeB64Decode(data.content));
                    
                    if (targetTab === 'notice') { setNoticeData(content); setShas(p => ({...p, notice: data.sha})); }
                    else if (targetTab === 'announcement') { setAnnouncementData(content); setShas(p => ({...p, announcement: data.sha})); }
                    else if (targetTab === 'events') { setEventsData(content); setShas(p => ({...p, events: data.sha})); }
                    else if (targetTab === 'security') { setLoginData(content); setShas(p => ({...p, security: data.sha})); }
                    
                    notify('success', `Synced ${path} from Live.`);
                } catch (err) {
                    notify('error', err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handlePublish = async () => {
                const mapping = { notice: 'notice.json', announcement: 'announcement.json', events: 'events.json', security: 'login.json' };
                const path = mapping[activeTab];
                const currentSha = shas[activeTab];

                if (!config.token || !currentSha) {
                    notify('error', 'Sync data from GitHub before applying live changes.');
                    return;
                }
                setLoading(true);
                const currentData = activeTab === 'notice' ? noticeData : activeTab === 'announcement' ? announcementData : activeTab === 'events' ? eventsData : loginData;

                try {
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${path}`;
                    const body = {
                        message: `Dashboard Update: ${path} by ${currentUser}`,
                        content: safeB64Encode(JSON.stringify(currentData, null, 2)),
                        sha: currentSha
                    };
                    const res = await fetch(url, {
                        method: 'PUT',
                        headers: { 'Authorization': `token ${config.token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    if (!res.ok) throw new Error('Update failed.');
                    const resData = await res.json();
                    setShas(prev => ({ ...prev, [activeTab]: resData.content.sha }));
                    notify('success', `Successfully updated ${path}!`);
                } catch (err) {
                    notify('error', err.message);
                } finally {
                    setLoading(false);
                }
            };

            const unlockSecurity = (e) => {
                e.preventDefault();
                if (securityPinInput === MASTER_PIN) {
                    setIsSecurityUnlocked(true);
                    setSecurityPinInput('');
                    handleSync('security');
                } else {
                    notify('error', 'Invalid PIN.');
                }
            };

            const getPublicStatus = () => {
                if(activeTab === 'notice') return noticeData.show;
                if(activeTab === 'announcement') return announcementData.show;
                if(activeTab === 'events') return eventsData.show;
                return false;
            };

            const togglePublicStatus = () => {
                if(activeTab === 'notice') setNoticeData({...noticeData, show: !noticeData.show});
                else if(activeTab === 'announcement') setAnnouncementData({...announcementData, show: !announcementData.show});
                else if(activeTab === 'events') setEventsData({...eventsData, show: !eventsData.show});
            };

            if (!isLoggedIn) {
                return html`
                    <div className="min-h-screen flex items-center justify-center p-6 bg-[#080a0e]">
                        <div className="glass-panel w-full max-w-md p-10 rounded-[3rem] animate-slide-up text-center border-orange-500/20 shadow-2xl">
                            <div className="bg-gradient-to-br from-orange-500 to-amber-600 w-16 h-16 rounded-2xl flex items-center justify-center font-black text-2xl text-white mx-auto shadow-2xl mb-8">RR</div>
                            <h2 className="text-2xl font-black text-white uppercase tracking-tight mb-2">RR College Admin</h2>
                            <p className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.4em] mb-12">Management Suite v4.0</p>
                            
                            <form onSubmit=${handleLogin} className="space-y-4">
                                <input 
                                    type="text" 
                                    value=${loginKeyInput} 
                                    onChange=${e => setLoginKeyInput(e.target.value.toUpperCase())} 
                                    className="w-full bg-black/60 border border-slate-800 p-5 rounded-3xl text-center font-mono tracking-widest text-lg outline-none focus:border-orange-500 transition-all text-white" 
                                    placeholder="ACCESS KEY"
                                />
                                <button type="submit" disabled=${loading} className="w-full bg-orange-600 hover:bg-orange-500 text-white font-black py-5 rounded-3xl text-xs uppercase tracking-widest shadow-xl transition-all disabled:opacity-50">
                                    ${loading ? html`<div className="loader mx-auto"></div>` : 'ENTER DASHBOARD'}
                                </button>
                            </form>
                            
                            <div className="mt-8 flex flex-col items-center gap-5">
                                <p className="text-[9px] text-slate-700 font-bold uppercase tracking-widest">Master Admin Protected</p>
                                <div className="bg-orange-500/10 border border-orange-500/30 p-4 rounded-2xl flex flex-col items-center gap-2 max-w-xs">
                                    <span className="text-[8px] font-black text-orange-500 uppercase tracking-widest">1 KEY = 1 DEVICE POLICY</span>
                                    <p className="text-[7px] text-slate-500 uppercase text-center font-bold">Access keys lock to the first device used. Contact Admin to reset locks.</p>
                                </div>
                                <a href="https://wa.me/919867637326" target="_blank" className="bg-[#25D366] hover:bg-[#1db954] text-white px-6 py-2.5 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] flex items-center gap-2 shadow-xl transition-all transform hover:scale-105">
                                    <span>üí¨ HELP</span>
                                </a>
                                <p className="text-[10px] font-bold text-slate-500 uppercase tracking-[0.3em]">
                                    Made By <span className="text-orange-500 font-black">Pawan Ponnam</span>
                                </p>
                            </div>
                        </div>
                        ${status && html`<div className="fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-red-600/10 border border-red-500 text-red-400 rounded-full text-[10px] font-black uppercase tracking-widest animate-slide-up shadow-2xl z-50 text-center max-w-[90%]">${status.message}</div>`}
                    </div>
                `;
            }

            return html`
                <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto flex flex-col gap-6">
                    <!-- Header -->
                    <header className="flex flex-col lg:flex-row justify-between items-center gap-6 bg-[#161b22] p-6 rounded-[2.5rem] border border-slate-800 shadow-2xl">
                        <div className="flex items-center gap-4">
                            <div className="bg-gradient-to-br from-orange-500 to-amber-600 w-14 h-14 rounded-2xl flex items-center justify-center font-black text-2xl text-white shadow-orange-900/40">RR</div>
                            <div>
                                <h1 className="text-xl font-black text-white tracking-tight">RR College Admin</h1>
                                <p className="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">Management Suite v4.0</p>
                            </div>
                        </div>

                        <div className="flex flex-col items-center gap-2">
                            <nav className="bg-black/40 p-1.5 rounded-2xl flex flex-wrap justify-center gap-1 border border-slate-800/50">
                                ${['notice', 'announcement', 'events', 'security'].map(tab => html`
                                    <button key=${tab} onClick=${() => { setActiveTab(tab); if(tab !== 'security') setIsSecurityUnlocked(false); }} className=${`px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === tab ? 'bg-orange-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}>
                                        ${tab === 'security' ? 'üîí Security' : tab}
                                    </button>
                                `)}
                            </nav>
                            <div className="bg-red-500/10 border border-red-500/20 px-4 py-1.5 rounded-full flex items-center gap-2 animate-pulse">
                                <span className="w-1.5 h-1.5 rounded-full bg-red-500"></span>
                                <span className="text-[9px] font-black text-red-500 uppercase tracking-widest">EXPIRES: ${formatTime(timeLeft)}</span>
                            </div>
                        </div>

                        <div className="flex flex-col items-center lg:items-end gap-3 text-center">
                            <div className="flex gap-2">
                                <button onClick=${handleLogout} className="px-5 py-3 bg-slate-800 border border-slate-700 rounded-2xl text-[9px] font-black text-slate-400 hover:text-white uppercase transition-all">Logout</button>
                                <button onClick=${() => handleSync()} disabled=${loading} className="px-5 py-3 bg-[#3366ff] hover:bg-[#2255ee] rounded-2xl text-[9px] font-black text-white shadow-lg uppercase flex items-center gap-2 transition-all">
                                    ${loading ? html`<div className="loader"></div>` : html`üîÑ Sync Live`}
                                </button>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-[10px] font-black text-slate-600 tracking-widest uppercase">Pawan Ponnam</span>
                                <a href="https://wa.me/919867637326" target="_blank" className="bg-[#25D366] hover:bg-[#1db954] text-white px-3 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-widest flex items-center gap-1.5 transition-all">
                                    <span>üí¨ HELP</span>
                                </a>
                            </div>
                        </div>
                    </header>

                    ${status && html`<div className="fixed bottom-8 right-8 z-[100] px-6 py-4 rounded-2xl border shadow-2xl animate-slide-up backdrop-blur-xl ${status.type === 'success' ? 'bg-green-600/10 border-green-500 text-green-400' : 'bg-red-600/10 border-red-500 text-red-400'} text-[10px] font-black uppercase tracking-widest">${status.message}</div>`}

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1">
                        <main className="lg:col-span-8 animate-slide-up">
                            <section className="glass-panel p-8 md:p-10 rounded-[3rem] shadow-2xl min-h-[700px] flex flex-col relative">
                                <div className="flex justify-between items-center border-b border-slate-800 pb-8 mb-8">
                                    <h2 className="text-3xl font-black text-white uppercase tracking-tighter">${activeTab} Manager</h2>
                                    ${activeTab !== 'security' && html`
                                        <button onClick=${togglePublicStatus} className=${`px-5 py-2.5 rounded-full text-[10px] font-black tracking-widest transition-all border-2 ${getPublicStatus() ? 'bg-green-600/10 border-green-500 text-green-400' : 'bg-slate-800/40 border-slate-700 text-slate-500'}`}>
                                            ${getPublicStatus() ? '‚óè PUBLIC STATUS' : '‚óã HIDDEN STATUS'}
                                        </button>
                                    `}
                                </div>

                                ${activeTab === 'security' ? html`
                                    ${!isSecurityUnlocked ? html`
                                        <div className="flex-1 flex flex-col items-center justify-center space-y-8">
                                            <div className="text-6xl animate-pulse">üîê</div>
                                            <div className="text-center">
                                                <h3 className="text-sm font-black text-slate-500 uppercase tracking-widest mb-2">Restricted Access</h3>
                                                <p className="text-[10px] text-slate-600 uppercase font-bold tracking-[0.2em]">Security PIN Required</p>
                                            </div>
                                            <form onSubmit=${unlockSecurity} className="w-full max-w-xs space-y-4">
                                                <input type="password" autoFocus value=${securityPinInput} onChange=${e => setSecurityPinInput(e.target.value)} className="w-full bg-black/60 border border-slate-800 p-5 rounded-3xl text-center font-mono tracking-widest text-lg outline-none focus:border-orange-500 text-white transition-all" placeholder="MASTER PIN"/>
                                                <button type="submit" className="w-full bg-white text-black font-black py-4 rounded-3xl text-[10px] uppercase tracking-widest shadow-xl">Unlock Module</button>
                                            </form>
                                        </div>
                                    ` : html`
                                        <div className="space-y-12 animate-slide-up">
                                            <div className="space-y-6">
                                                <h3 className="text-xs font-black text-orange-500 uppercase tracking-widest">Browser Configuration</h3>
                                                <div className="grid grid-cols-1 md:grid-cols-12 gap-5">
                                                    <div className="md:col-span-12">
                                                        <label className="text-[9px] font-black uppercase text-slate-600 block pl-1 mb-2">GitHub Token (Private to this browser)</label>
                                                        <input type="password" value=${config.token} onChange=${e => setConfig({...config, token: e.target.value})} className="w-full bg-black border border-slate-800 p-5 rounded-2xl text-xs text-white outline-none focus:border-orange-500 transition-all"/>
                                                    </div>
                                                    <div className="md:col-span-12">
                                                        <label className="text-[9px] font-black uppercase text-slate-600 block pl-1 mb-2">GitHub Owner</label>
                                                        <input value=${config.owner} onChange=${e => setConfig({...config, owner: e.target.value})} className="w-full bg-black border border-slate-800 p-5 rounded-2xl text-xs text-white outline-none focus:border-orange-500 transition-all"/>
                                                    </div>
                                                    <div className="md:col-span-4">
                                                        <label className="text-[9px] font-black uppercase text-slate-600 block pl-1 mb-2">Repo Name</label>
                                                        <input value=${config.repo} onChange=${e => setConfig({...config, repo: e.target.value})} className="w-full bg-black border border-slate-800 p-5 rounded-2xl text-xs text-white outline-none focus:border-orange-500 transition-all"/>
                                                    </div>
                                                    <div className="md:col-span-8 flex items-end">
                                                        <div className="w-full h-[58px] bg-green-900/10 border-2 border-green-500/40 rounded-2xl flex items-center justify-center px-4">
                                                            <span className="text-[11px] font-black text-green-500 uppercase tracking-[0.2em]">Device ID: ${getDeviceId()}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="space-y-6 pt-10 border-t border-slate-800">
                                                <div className="flex justify-between items-center">
                                                    <h3 className="text-xs font-black text-orange-500 uppercase tracking-widest">Access Controls</h3>
                                                    <button onClick=${() => setLoginData({...loginData, keys: [{id: crypto.randomUUID(), key: 'RR-'+Math.random().toString(36).substring(2,8).toUpperCase(), owner: 'New Admin', isActive: true, deviceId: null}, ...loginData.keys]})} className="bg-orange-600 hover:bg-orange-500 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest">+ New Admin</button>
                                                </div>
                                                <div className="space-y-4">
                                                    ${loginData.keys.map((k, idx) => html`
                                                        <div key=${k.id} className="bg-black/30 p-6 rounded-[2rem] border border-slate-800/60 flex flex-col gap-5 animate-slide-up">
                                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                                                                <div>
                                                                    <label className="text-[8px] font-black uppercase text-slate-600 block mb-2 tracking-widest">Admin Name</label>
                                                                    <input value=${k.owner} onChange=${e => { const up = [...loginData.keys]; up[idx].owner = e.target.value; setLoginData({...loginData, keys: up}); }} className="bg-transparent border-b border-slate-800 text-sm font-bold text-white outline-none focus:border-orange-500 w-full p-1"/>
                                                                </div>
                                                                <div>
                                                                    <label className="text-[8px] font-black uppercase text-slate-600 block mb-2 tracking-widest">Key Code</label>
                                                                    <input value=${k.key} onChange=${e => { const up = [...loginData.keys]; up[idx].key = e.target.value; setLoginData({...loginData, keys: up}); }} className="bg-transparent border-b border-slate-800 text-sm font-mono text-orange-400 outline-none focus:border-orange-500 w-full p-1"/>
                                                                </div>
                                                            </div>
                                                            <div className="flex flex-col md:flex-row justify-between gap-4 items-center pt-2 border-t border-slate-800/40">
                                                                <div className="flex items-center gap-3">
                                                                    ${k.deviceId ? html`
                                                                        <div className="bg-orange-600/10 border border-orange-500/20 px-3 py-1.5 rounded-xl flex items-center gap-2">
                                                                            <span className="text-[8px] font-black text-orange-500 uppercase tracking-widest">BOUND: ${k.deviceId}</span>
                                                                            <button onClick=${() => { const up = [...loginData.keys]; up[idx].deviceId = null; setLoginData({...loginData, keys: up}); }} className="text-orange-500 hover:text-white font-black text-[9px] uppercase">Reset Lock</button>
                                                                        </div>
                                                                    ` : html`
                                                                        <div className="px-3 py-1.5 rounded-xl border border-dashed border-slate-700 flex items-center bg-slate-800/20">
                                                                            <span className="text-[8px] font-black text-slate-500 uppercase tracking-widest">UNBOUND (WILL LOCK TO FIRST LOGIN)</span>
                                                                        </div>
                                                                    `}
                                                                </div>
                                                                <div className="flex justify-end gap-3 items-center">
                                                                    <button onClick=${() => { const up = [...loginData.keys]; up[idx].isActive = !up[idx].isActive; setLoginData({...loginData, keys: up}); }} className=${`px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest transition-all ${k.isActive ? 'bg-green-600/10 text-green-500 border border-green-500/20' : 'bg-red-600/10 text-red-500 border border-red-500/20'}`}>${k.isActive ? 'ACTIVE' : 'DISABLED'}</button>
                                                                    <button onClick=${() => setLoginData({...loginData, keys: loginData.keys.filter((_, i) => i !== idx)})} className="text-red-500 hover:text-white p-2">‚úï</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    `)}
                                                </div>
                                            </div>
                                        </div>
                                    `}
                                ` : activeTab === 'notice' ? html`
                                    <div className="space-y-10 animate-slide-up flex-1">
                                        <div>
                                            <label className="text-[11px] font-black text-slate-500 uppercase block mb-3 pl-1">Notice Headline</label>
                                            <input value=${noticeData.title} onChange=${e => setNoticeData({...noticeData, title: e.target.value})} className="w-full bg-[#0d1117] border border-slate-800 p-6 rounded-[2rem] text-xl font-bold text-white outline-none focus:border-orange-500 transition-all"/>
                                        </div>
                                        <div>
                                            <label className="text-[11px] font-black text-slate-500 uppercase block mb-3 pl-1">Notice Body</label>
                                            <textarea rows="12" value=${noticeData.message.join('\n')} onChange=${e => setNoticeData({...noticeData, message: e.target.value.split('\n')})} className="w-full bg-[#0d1117] border border-slate-800 p-6 rounded-[2rem] text-sm text-slate-300 outline-none focus:border-orange-500 custom-scrollbar resize-none leading-relaxed"/>
                                        </div>
                                    </div>
                                ` : activeTab === 'announcement' ? html`
                                    <div className="space-y-10 animate-slide-up flex-1">
                                        <div>
                                            <label className="text-[11px] font-black text-slate-500 uppercase block mb-3 pl-1">Announcement Title</label>
                                            <input value=${announcementData.title} onChange=${e => setAnnouncementData({...announcementData, title: e.target.value})} className="w-full bg-[#0d1117] border border-slate-800 p-6 rounded-[2rem] text-xl font-bold text-white outline-none focus:border-orange-500 transition-all"/>
                                        </div>
                                        <div>
                                            <label className="text-[11px] font-black text-slate-500 uppercase block mb-3 pl-1">Full Message Content</label>
                                            <textarea rows="12" value=${announcementData.message} onChange=${e => setAnnouncementData({...announcementData, message: e.target.value})} className="w-full bg-[#0d1117] border border-slate-800 p-6 rounded-[2rem] text-sm text-slate-300 outline-none focus:border-orange-500 leading-relaxed resize-none"/>
                                        </div>
                                    </div>
                                ` : activeTab === 'events' ? html`
                                    <div className="space-y-10 animate-slide-up flex-1">
                                        <button onClick=${() => setEventsData({...eventsData, events: [{title: 'New Event Headline', content: ['Detail Item 1'], theme: {gradient: ["#ff9800", "#ff5722"], glow: "rgba(255,152,0,0.5)"}}, ...eventsData.events]})} className="w-full py-6 border-2 border-dashed border-slate-800 rounded-[2.5rem] text-slate-500 hover:text-orange-500 hover:border-orange-500 transition-all font-black uppercase text-[10px] tracking-widest">+ Create New Event Card</button>
                                        <div className="space-y-8">
                                            ${eventsData.events.map((ev, i) => html`
                                                <div key=${i} className="bg-black/40 p-8 rounded-[3rem] border border-slate-800 relative group">
                                                    <button onClick=${() => setEventsData({...eventsData, events: eventsData.events.filter((_, idx) => idx !== i)})} className="absolute top-6 right-6 text-red-500/50 hover:text-red-500 p-2">‚úï</button>
                                                    <div className="space-y-6">
                                                        <div><label className="text-[9px] font-black uppercase text-slate-600 block mb-2">Event Title</label><input value=${ev.title} onChange=${e => { const up = [...eventsData.events]; up[i].title = e.target.value; setEventsData({...eventsData, events: up}); }} className="w-full bg-black/40 border border-slate-800 p-4 rounded-2xl text-lg font-black text-white outline-none focus:border-orange-500"/></div>
                                                        <div><label className="text-[9px] font-black uppercase text-slate-600 block mb-2">Points (1 per line)</label><textarea value=${ev.content.join('\n')} onChange=${e => { const up = [...eventsData.events]; up[i].content = e.target.value.split('\n'); setEventsData({...eventsData, events: up}); }} rows="4" className="w-full bg-black/40 border border-slate-800 p-4 rounded-2xl text-xs text-slate-400 outline-none focus:border-orange-500 resize-none"/></div>
                                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                                            <div><label className="text-[8px] font-black uppercase text-slate-600 mb-2 block">Color A</label><input type="color" value=${ev.theme?.gradient[0]} onChange=${e => { const up = [...eventsData.events]; up[i].theme.gradient[0] = e.target.value; setEventsData({...eventsData, events: up}); }} className="w-full h-10 bg-transparent rounded-lg border-none cursor-pointer"/></div>
                                                            <div><label className="text-[8px] font-black uppercase text-slate-600 mb-2 block">Color B</label><input type="color" value=${ev.theme?.gradient[1]} onChange=${e => { const up = [...eventsData.events]; up[i].theme.gradient[1] = e.target.value; setEventsData({...eventsData, events: up}); }} className="w-full h-10 bg-transparent rounded-lg border-none cursor-pointer"/></div>
                                                            <div className="col-span-2 md:col-span-1"><label className="text-[8px] font-black uppercase text-slate-600 mb-2 block">Glow</label><input value=${ev.theme?.glow} onChange=${e => { const up = [...eventsData.events]; up[i].theme.glow = e.target.value; setEventsData({...eventsData, events: up}); }} className="w-full bg-black/60 border border-slate-800 p-2 text-[10px] text-white rounded-lg outline-none"/></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            `)}
                                        </div>
                                    </div>
                                ` : null}

                                <button onClick=${handlePublish} disabled=${loading} className="w-full mt-10 py-8 bg-gradient-to-r from-orange-600 to-amber-500 hover:from-orange-500 hover:to-amber-400 text-white font-black text-2xl rounded-[2.5rem] shadow-2xl uppercase tracking-[0.2em] transition-all transform active:scale-95 disabled:opacity-30">
                                    ${loading ? html`<div className="loader mx-auto"></div>` : 'üöÄ Apply Live Changes'}
                                </button>
                            </section>
                        </main>

                        <aside className="lg:col-span-4 space-y-8">
                            <section className="glass-panel p-8 rounded-[3rem] sticky top-8 flex flex-col h-[calc(100vh-6rem)] overflow-hidden">
                                <h3 className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-10 flex items-center gap-3"><span className="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></span> Dynamic Preview</h3>
                                <div className="flex-1 bg-[#080a0e] rounded-[2.5rem] p-6 overflow-y-auto custom-scrollbar shadow-inner space-y-8">
                                    ${activeTab === 'notice' ? html`
                                        <div className="w-full bg-[#161a22] p-8 rounded-[2.5rem] border border-slate-800 relative overflow-hidden animate-slide-up shadow-2xl">
                                            <div className="absolute top-0 left-0 w-full h-1.5 bg-orange-600"></div>
                                            <h4 className="text-orange-500 font-black text-xl uppercase mb-5">${noticeData.title || 'HEADLINE'}</h4>
                                            <div className="space-y-4">${noticeData.message.map((l, i) => html`<p key=${i} className="text-slate-400 text-xs font-medium leading-relaxed">${l}</p>`)}</div>
                                        </div>
                                    ` : activeTab === 'announcement' ? html`
                                        <div className="bg-[#1e2329] p-10 rounded-[3rem] border border-slate-700 text-center shadow-2xl animate-slide-up">
                                            <div className="text-5xl mb-6">üì¢</div>
                                            <h4 className="text-white font-black text-2xl uppercase mb-5">${announcementData.title || 'HELLO!!'}</h4>
                                            <p className="text-slate-400 text-sm leading-relaxed mb-8">${announcementData.message || 'Message content here...'}</p>
                                            <div className="py-4 bg-orange-600 text-white text-[10px] font-black uppercase rounded-2xl tracking-widest shadow-xl">PREVIEW ONLY</div>
                                        </div>
                                    ` : activeTab === 'events' ? eventsData.events.map((ev, i) => html`
                                        <div key=${i} className="p-10 rounded-[3rem] text-white shadow-2xl animate-slide-up" style=${{ background: `linear-gradient(135deg, ${ev.theme?.gradient?.join(', ') || '#161a22, #0d1117'})`, boxShadow: `0 20px 60px ${ev.theme?.glow || 'transparent'}` }}>
                                            <h4 className="text-2xl font-black uppercase mb-6 leading-tight">${ev.title || 'EVENT TITLE'}</h4>
                                            <div className="space-y-3">${ev.content.map((l, ii) => html`<p key=${ii} className="text-[12px] font-medium opacity-90 tracking-tight">‚Ä¢ ${l}</p>`)}</div>
                                        </div>
                                    `) : html`<div className="h-full flex items-center justify-center opacity-20 text-[9px] font-black uppercase tracking-widest text-center px-6">System Console Idle</div>`}
                                </div>
                            </section>
                        </aside>
                    </div>

                    <footer className="text-center pt-32 pb-16 flex flex-col items-center gap-6 opacity-40">
                        <p className="text-slate-700 text-[10px] font-black uppercase tracking-[0.6em]">RR International College</p>
                        <p className="text-[8px] font-bold text-slate-800 uppercase tracking-[0.4em]">ENCRYPTED MANAGEMENT ENVIRONMENT V4.0</p>
                    </footer>
                </div>
            `;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>